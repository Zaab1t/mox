<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spreadsheet upload</title>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script>
        (function () {
            var jobId = {{ jobId|tojson }};
            if (jobId) {
                var poller = setInterval(function(){
                    console.log("getting /moxdocumentupload/status?jobId="+jobId);
                    $.get({
                        url: "status",
                        data: {'jobId': jobId},
                        dataType: "json",
                        success: function(responseObject, status, jqXHR){
                            if (responseObject && 'response' in responseObject) {
                                var serviceResponse = responseObject.response;
                                if (typeof(serviceResponse)=="string") {
                                    try {
                                        serviceResponse = JSON.parse(serviceResponse);
                                    } catch (e) {}
                                }
                                if (typeof(serviceResponse)=="object") {
                                    for (var id in serviceResponse) {
                                        var responseNode = $("<p>");
                                        responseNode.text("uuid: " + serviceResponse[id].uuid);
                                        $("#responseContainer").append(responseNode);
                                    }
                                }
                                clearInterval(poller);
                                poller = null;
                            }
                        },
                        error: function(){
                            clearInterval(poller);
                            poller = null;
                        }
                    });
                }, 1000);
            }
        })();
    </script>
</head>
<body>
<p>Spreadsheet has been submitted.</p>
<p>Response:</p>
<div id="responseContainer"></div>
</body>
</html>
